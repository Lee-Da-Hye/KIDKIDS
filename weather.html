<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>날씨예보</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>

<div id="dust">
    <h1>날씨예보</h1>
    <div id="dustStatus">
        <h2 id="location">위치를 가져오는 중...</h2>
        <p id="dustStatusText">미세먼지 농도: </p>
        <p id="ozoneStatusText">오존 농도: </p>
    </div>
</div>

<script>
// API 키
var apiKey = 'LukiVznMrRVfgr%2FmME%2Flropqo%2Fn39Hq74bNK9gZh1%2B8oW%2BLAi70wMvDqzgXK3cAyZzlWSKjieh68kBnwM8TQoQ%3D%3D';

// 사용자의 위치 정보를 가져오는 함수
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
    } else {
        // Geolocation을 지원하지 않는 경우, 기본 위치 정보인 서울로 설정
        updateDustInfo('서울');
    }
}

// 위치 정보를 받아와 화면에 표시하는 함수
function showPosition(position) {
    var latitude = position.coords.latitude;
    var longitude = position.coords.longitude;
    
    // API 호출
    var apiUrl = `https://apis.data.go.kr/B552584/ArpltnInforInqireSvc/getCtprvnRltmMesureDnsty?serviceKey=${apiKey}&returnType=json&numOfRows=100&pageNo=1&sidoName=%EC%84%9C%EC%9A%B8&ver=1.0`;
    
    $.getJSON({
        url: apiUrl,
        success: function(data) {
            var items = data.response.body.items;
            var dustStatus = getDustStatus(items);
            var ozoneStatus = getOzoneStatus(items);
            updateDustInfo('서울', dustStatus, ozoneStatus);
            console.log(data.response.body.items)
        },
        error: function(xhr, status, error) {
            console.error('API 요청 실패:', status, error);
            // 실패 시 기본 위치 정보인 서울로 설정
            updateDustInfo('서울');
        }
    });
}

// 위치 정보를 가져오는데 실패했을 때 처리하는 함수
function showError(error) {
    // 위치 정보를 가져오지 못한 경우, 기본 위치 정보인 서울로 설정
    updateDustInfo('서울');
}

// 미세먼지 농도를 가져오는 함수
function getDustStatus(items) {
    var pm10Value = items[0].pm10Value;
    return pm10Value + ' μg/m³'; // 단위: 마이크로그램/미터³
}

// 오존 농도를 가져오는 함수
function getOzoneStatus(items) {
    var o3Value = items[0].o3Value;
    return o3Value + ' ppb'; // 단위: 파트 퍼 브리언트
}

// 미세먼지 및 오존 상태를 업데이트하여 화면에 표시하는 함수
function updateDustInfo(location, dustStatus = '보통', ozoneStatus = '보통') {
    document.getElementById('location').textContent = location;
    document.getElementById('dustStatusText').textContent = '미세먼지 농도: ' + dustStatus;
    document.getElementById('ozoneStatusText').textContent = '오존 농도: ' + ozoneStatus;
}

// 페이지 로드 시 위치 정보 가져오기
window.onload = getLocation;
</script>

</body>
</html>
